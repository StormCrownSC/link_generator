<!DOCTYPE html>
<html>
<head>
    <title>Link generator</title>
</head>
<body>
<form id="shorten-form" method="post" enctype="application/x-www-form-urlencoded">
    <p>Сгененрировать короткую ссылку</p>
    <input type="text" id="url" name="url"/>
    <input type="submit" id="subshot"></input>
</form>

<p id="resultsh"></p><br/>
<form id="long-form" method="get" enctype="application/x-www-form-urlencoded">
    <p>Получить полную ссылку</p>
    <input type="text" id="shot_url" name="shot_url"/>
    <input type="submit" id="sublong"/>
</form>

<p id="resultlong"></p><br/>
<form id="all-link-form" method="get" enctype="application/x-www-form-urlencoded">
    <p>Получить все ссылки</p>
    <input type="submit" id="suball"></input>
</form>
<p id="resultall"></p><br/>

<form id="del-link-form" method="get" enctype="application/x-www-form-urlencoded">
    <p>Ввведите полную ссылку для удаления из бд</p>
    <input type="text" id="del_url" name="full_url"/>
    <input type="submit" id="subdel"></input>
</form>

<script>
    const form = document.querySelector('#shorten-form');
    const resultsh = document.querySelector('#resultsh');


    let socket = new WebSocket("wss://localhost:11000");

    socket.onopen = function(e) {
        alert("[open] Соединение установлено");
    };

    socket.onclose = function(event) {
        if (event.wasClean) {
            alert(`[close] Соединение закрыто чисто`);
        } else {
            alert('[close] Соединение прервано');
        }
    };

    socket.onerror = function(error) {
        alert(`[error]`);
    };

    form.addEventListener('submit', async (event) => {
        var url = document.getElementById("url").value;
        event.preventDefault();
        var request = {'url':url}
        socket.send(JSON.stringify(request))
        socket.onmessage = (event) => {
            let message = event.data;
            resultsh.innerHTML = "<a href=" + url + ">" + message + "  </a>";
            console.log(message)
            socket.send(JSON.stringify(request))
            socket.onmessage = (event) => {
                let message = event.data;
                resultsh.innerHTML = "<a href=" + url + ">" + message + "  </a>";
                console.log(message)
            };
        };

    });

    const longform = document.querySelector('#long-form');
    const resultlong = document.querySelector('#resultlong');

    longform.addEventListener('submit', async (event) => {
        var shot_url = document.getElementById("shot_url").value;
        event.preventDefault();
        const response = await fetch('http://localhost:11000/shorten?shortlink=' + shot_url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            },
        });
        const data = await response.json();
        resultlong.innerHTML = "<a href=" + data.Link + ">" + data.Link + " </a>";
        console.log(data)
    });
</script>
</body>
</html>